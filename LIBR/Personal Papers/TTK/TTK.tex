\documentclass{article}
% Choose a conveniently small page size
\usepackage[paperheight=16cm,paperwidth=14cm,textwidth=12cm]{geometry}
\usepackage[skip=10pt plus1pt, indent=40pt]{parskip}
\usepackage[colorlinks=true]{hyperref}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amssymb,amsmath,amsthm}
\usepackage{geometry}
\usepackage{verbatim}
\geometry{legalpaper, margin=1 in}

\title{A Study of Time to Kill in Vermintide 2: A Probabilistic Approach}
\author{John Hiles}
\date\today
%This information doesn't actually show up on your document unless you use the maketitle command below

\begin{document}
\maketitle %This command prints the title based on information entered above

\section{Introduction}
%Section and subsection automatically number unless you put the asterisk next to them.

\par

	Typically in most video games(especially with loot systems downstream of Diablo), discussion around optimizing characters or classes tends to revolve around \textbf{Damage Per Second} or \textbf{DPS}. However, Vermintide 2 differs from the vast majority of games in a number of key ways. The most important is that players in Vermintide are confronted with many enemies, far more than is normal in games with comparable class customization systems. In most games in which optimal play is often well represented by maximizing DPS, enemies are strong and take time measured in seconds or minutes to die. In Vermintide, players are often expected to kill multiple enemies every second. This difference is subtle but important.

Suppose we gave Bardin Goreksson a magical Axe. Imagine this axe could swing once every 30 minutes, but everything it touches receives $1,000,000$ points of damage. Without even considering multi target damage, this axe would still have the highest damage per second of any weapon in the game(555.5 damage per second to be precise) despite the fact it could only be used once per run. While it might be fun to instantly delete a single enemy once per run, I have a hard time imagining that weapon ever becoming the meta pick; except maybe to win a particularly nasty event or difficulty spike. The point here, is to demonstrate in an exaggerated manner why \textbf{DPS} fails to describe what is and what is not a good weapon in Vermintide.

In truth, the quantity that we should more interested in optimizing is \textbf{Time to Kill} or \textbf{TTK}. That being said performing mathematical analysis on time to kill is easier said than done. Part of the reason DPS is an attractive metric is that its quite easy to calculate. However TTK is harder to work with, since TTK varies depending on the animation speed of the weapon, attack speed modifiers on a particular career, and whether or not an attack was a critical hit or not, and whether or not that attack was a headshot. The statistics minded among you will probably have noticed that two of those quantities are not totally deterministic. \textbf{HS\%} (Headshot percentage) can either be treated as random or a stochastic process which can be modeled as random, and \textbf{C\%} (Crit Chance) is a truly random quantity.

As such, it is my objective in this article to demonstrate how basic probability can be applied to help you become a better rat slayer.

\subsection*{Probability for the Uninitiated}
\par

In this article we will be using basic rules and principles in probability. So before we begin this discussion in earnest, it is necessary to lay some groundwork.

To people who don't study math, the point of mathematical notation is not to make things confusing(though many find it confusing); but to convey lots of information without needing to write out whole paragraphs about it. Mathematics at its core is a language, but to understand it you need to know the words. For this article, take this as something of a glossary for the equations and language which I will use in this.

\subsubsection{\textbf{Event}}

An Event is anything that happens in the real world that can be measured. Did the coin flip result in heads of tails? It is common in probability to define events in terms of capital letters. Event $H$ means a coin was flipped and landed on Heads. Event $T$ means a coin was flipped and landed on tails. In this article, instead of using letters of the alphabet, it is easier to use subscripts to denote different events. So you will often see events labelled $A_1,A_2,A_i$. This is no different than calling them $A$, $B$, or $C$. A more formal definition is that an Event is the outcome of a random experiment.

\subsubsection{Probability Functions \textbf{P()}}

P(•) is what is known as a probability function. The input of this function is an event, and the output of this function is the probability of that event occurring. Back to our coinflip example, $P(H)$ represents the probability that a coinflip results in heads. Or $P(A_1)$ is the probability that event $A_1$ occurs.

\subsubsection{Statistical Independence}

Statistical Independence is an incredibly important concept in probability. The layman's explanation which is sufficient for this discussion is that if we have two random processes, if one does not affect the other in any way they are considered statistically independent. For example, my headshot rate does not affect how often my attacks are critical hits and vise versa. Independence is required to make any of the math done in this article work.

\subsubsection{AND Rule}

The AND rule for probability states that for two (or more) statistically independent events A and B. The probability of BOTH occuring is the product of their individual probabilities.
\begin{align*}
P(A \text{ and } B) = P(A)P(B)
\end{align*}
If A and B are too abstract for you, lets consider two coin flips. What is the probability that we flip a heads AND a tails in two flips?
\begin{align*}
P(H \text{ and } T) = P(H)P(T) = (\tfrac{1}{2})(\tfrac{1}{2}) = \frac{1}{4}
\end{align*}
The probability is you have a 1 in 4 chance of that happening.

\subsubsection{OR Rule}

The OR rule of probability states that for two (or more) statistically independent and mutually exclusive events A and B; The probability of either A or B occurring is the sum of their individual probabilities.
\begin{equation}
P(A \text{ or } B) = P(A)+P(B)
\end{equation}
Once again we consider the coin flip. What is the probability that we will flip a coin and observe either a Heads or a Tails? According to the OR rule:
\begin{align*}
P(H \text{ or } T) = P(H)+P(T) = \tfrac{1}{2}+\tfrac{1}{2} = 1
\end{align*}
That example is a bit simplistic, so consider a 6 sided fair die. What is the probability that we roll an even number? What we are doing is trying to determine the probability we roll a 2, a 4, or a 6. Each one of those has an individual probability of $\dfrac{1}{6}$ of being individually rolled. So by the OR rule we end up with:
\begin{align*}
P(\text{Even Number}) = \tfrac{1}{6}+\tfrac{1}{6}+\tfrac{1}{6} = \tfrac{3}{6} = \tfrac{1}{2}
\end{align*}
Note that there is another variant for the OR rule which works for non mutually exclusive events, which is more applicable for this.
\begin{equation}
P(A \text{ or } B) = P(A)+P(B) - P(A and B)
\end{equation}
If $A$ and $B$ are independant, then this reduces to:
\begin{equation}
P(A \text{ or } B) = P(A)+P(B) - P(A)P(B)
\end{equation}

\subsubsection{Law of Total Probability}

This may sound complicated but its fairly simple really. For any random experiment where you can specify all possible outcomes as events; the sum of the probabilities of these events occurring must sum to 1.

\begin{equation}
1 = P(A_1) + P(A_2) + ... + P(A_n)
\end{equation}

So to demonstrate this, we can examine our Dice Example. Let $A_1$ be the event which represents rolling an even number, and $A_2$ be the event where you role an odd number.

\begin{align*}
1 = P(A_1) + P(A_2) = \tfrac{1}{2} + \tfrac{1}{2}
\end{align*}

\subsubsection{Expectation}
Expectation is a mathematical generalization of the weighted average or the arithmetic mean. The expectation of a random variable is essentially the expected value which that random variable takes. This is an incredibly deep and mathematically complex topic, so for the purposes of this discussion the expectation just refers to finding the expected value of something. If a random experiment occurs, what do I expect the result to be most of the time?
\begin{align*}
\mathbb{E}(X) = \sum_{i=1}^{\infty} P(A_i) x_i
\end{align*}


\begin{comment}
\subsubsection{Variable}
Here is a list of variable names.
\begin{enumerate}
\item $\tau$ = Time to Kill
\item $\rho$ = Crit Chance
\item $\phi$ = Headshot Percentage
\item $\alpha$ = Attack Speed
\end{enumerate}

\begin{align*}
P(A_1) = \rho + \phi = 0.55 && P(A_2) = 1 - P(A_1) = 0.45
\end{align*}
\begin{align*}
\mathbb{E}(\tau) = \alpha (P(A_1) (t_1) + P(A_2) t_2)
\end{align*}

\begin{align*}
P(A_1) = \mathbf{HS\%} + \mathbf{C\%} = 0.55 && P(A_2) = 1 - P(A_1) = 0.45
\end{align*}
\begin{align*}
\mathbb{E}(\mathbf{TTK}) = \mathbf{AS} (P(A_1) (t_1) + P(A_2) t_2)
\end{align*}
\end{comment}

\section{An Introductory Example}

\par

Before delving deep into math I want to introduce you to the example which gave me the idea to write this document. This situation is something of a mathematical special case where all the logic and the calculations are quite simple and intuitive.

Consider Bardin's Cog Hammer. The Cog Hammer is a very high damage but slow attack speed weapon which is known for its high armor damage. In case you are unaware, the Cog Hammer has an attainable \textbf{1HHS} (one hit head shot) breakpoint on stormvermin while playing as Slayer. Hence one of Slayer's primary roles on a team is to use the Cog Hammer on waves of Stormvermin since he can kill them in either one head shot or two body shots. In fact it is quite common for Slayer to chain heavy attacks while a large quantity of Stormvermin charge them. For the sake of this example, lets suppose 10 stormvermin attack a lone slayer. So if we consider that most players won't have 100\% headshot rate, some of these stormvermin will die in 1 hit, and some will die in 2 hits. The ratio of 1 hit to 2 hit kills then IS the headshot rate of this engagement. A headshot rate of 40\% means 4 out of those 10 stormvermin died in one hit. So without considering crit chance, we can say that we \emph{expect} 4 stormvermin to die in one hit, and 6 stormvermin to die in 2 hits.

However another important thing to consider is that Slayer wielding Cog Hammer also has a \textbf{1HBS} (one hit body shot) critical hit breakpoint on Stormvermin. Meaning that in addition to the ones which die in one hit to a headshot, sometimes they will die in one hit to a crit bodyshot. However, if a player happens to get a critical hit AND a headshot, that crit will have no effect in how quickly the player kills the wave of Stormvermin; since that Stormvermin would have died in the same amount of time from the headshot. So how many Stormvermin do we expect to die in 1 hit versus 2? To answer that question factoring in \textbf{HS\%} headshot percentage and \textbf{C\%} crit chance we now need to consider basic rules of probability or random variables.

Consider these possible cases that can occur when fighting a single Stormvermin
\begin{enumerate}
\item[A.] Headshot AND no Crit (1 Hit Kill)
\item[B.] Crit AND Body Shot(1 Hit Kill)
\item[C.] Crit AND Headshot (1 Hit Kill)
\item[D.] Bodyshot AND Bodyshot (2 Hit Kill)
\item[E.] Bodyshot AND Headshot (2 Hit Kill)
\item[F.] Bodyshot AND Crit Headshot (2 Hit Kill)
\end{enumerate}

Assuming that the slayer is only using Cog Hammer heavy attacks, there are no other possible ways for stormvermin to be damaged twice without dying. However, for the sake of this introductory example, we can simplify these by simply talking about the cases in which the stormvermin dies in a single hit or in two hits. This here is how we will define our \emph{events} $A_1$ and $A_2$.

\begin{enumerate}
\item[$A_1$.] Headshot OR Critical Bodyshot (1 Hit Kill)
\item[$A_2$.] Body shot (1 Hit Kill)
\end{enumerate}

The probability of critting or headshotting are independent but not mutually exclusive. We can apply the non mutually exclusive OR rule to calculate this:

\begin{enumerate}
\item $\tau$ = Time to Kill
\item $\rho$ = Crit Chance
\item $\phi$ = Headshot Percentage
\item $\alpha$ = Attack Speed
\end{enumerate}
\begin{align*}
P(A_1) = P(\rho) + P(\phi) - P(\rho)P(\phi) \\
P(A_1) = 0.25 + 0.4 - (0.25)(0.4) = 0.55
\end{align*}

Since we know that the total probability of both of these events must sum to 1(because there are no other possibilities). We then know that the probability of $A_2$ is:

\begin{align*}
P(A_2) = 1-P(A_1) = 0.45
\end{align*}

With this in mind, we now know the relative percentage of the time for a given headshot rate that  slayer kills in one hit versus two hits. It means 5.5 SV on average will die in one hit when factoring in crit chance.

This result is staggering to me since it means 55\% of the time you will kill a Stormvermin in one hit with only a modest headshot rate and an attainable crit chance.

Note, that so far none of the calculations we have done are necessarily specific to the Cog Hammer or any particular weapon or career. These probabilities are not career or talent specific, instead they only depend on the breakpoints of a particular weapon/build combination. The only thing that is required for this formula to apply is that the weapon kills an enemy on a crit body shot, and kills an enemy on a non critical headshot.

In fact, Slayer's Dual Axes have this exact set of breakpoints on slave rats. Meaning that the probability of killing a slave rat in one hit is \emph{also} (assuming same crit chance and headshot rate) is also 55\%.

The astute among you will have noticed that right now I am talking in terms of probabilities, when the title of this article specifically states that we are trying to study "Time to Kill". What we have done so far is calculate the probabilities (or weights) that one outcome versus another occurs. As such, to find the actual TTK, we need to compute a weighted average of the time it takes to kill in 1 hit and the time it takes to kill in 2 hits.

This is the step where our calculations become much less general, and we start using numbers which are very specific to particular classes and builds. To relate our calculated probabilities to time in the real world, we need to find out how many attacks per unit time our weapon. In this discussion, I am going to call this \emph{Attack Rate} so as not to confuse this with \emph{Attack Speed} (\text{AS}) which is a multiplicative percentage based modifier of \emph{Attack Rate}.

Our generalized formula for the expected TTK to kill a singular enemy is this:
\begin{equation}
\mathbb{E}(\mathbf{TTK}) = \alpha \sum_{i=1}^{n} P(A_i) t_i
\end{equation}

In english, the expected time to kill is a weighted average between the time to kill in $1$ hit, in $2$ hits, or $n$ hits; weighted according to the probabilities of each happening. $t$ is the time it takes for particular combo to happen. $P(A_i)$ is the probability that the Event $A_i$ will come to pass; in this context, we've defined $A_1$ as the event in which the enemy dies in 1 hit, so $i$ corresponds to the number of hits to kill. Then, we multiply that weighted average by the total attack speed modifier of our career/weapon properties/charm properties. For this formula to work, you must include every combo which you personally will plan to use/analyze. $n$ is the maximum number of hits it takes to kill a particular enemy. For Stormvermin in our coghammer example, $n=2$. So if you are scared of the sigma notation, here is a version you might be more familiar with:

\begin{align*}
\mathbb{E}(\mathbf{TTK}) = \alpha (P(A_1) t_1 + P(A_2) t_2)
\end{align*}

Recall that we explicitly solved for $P(A_1)$ and $P(A_2)$ earlier(for the slayer breakpoints). So we can substitute them into our expression here:

\begin{align*}
\mathbb{E}(\mathbf{TTK}) = \alpha ([\phi + \rho] t_1 + [1-\phi+ \rho] t_2)
\end{align*}

Lets plug in some real numbers! I run this \href{https://www.ranalds.gift/build/IKtCgpNH7INsPonDHAHZ/view}{this} particular slayer build. It has a cumulative 25\% crit chance $\mathbf{C\%} = 0.25$. A conservative headshot ratio for chain Cog Hammer heavies is 40\%. So using our numbers. We calculated $P(A_1)$ and $P(A_2)$ earlier:
\begin{align*}
P(A_1) = 0.55 && P(A_2) = 0.45
\end{align*}
Substituting these into our expression:
\begin{align*}
\mathbb{E}(\mathbf{TTK}) = \alpha (0.55 (t_1) + (0.45) t_2)
\end{align*}

According to VernonKun's DPS spreadsheet which gives time for various combos(Sourced from Melee Armory Mod), it states the H1+H2 combo has a total time of $2.4121 s$. So if we are analyzing chain heavies, then $t_1=\tfrac{2.4121 s}{2}=1.2061 s$ and $t_2 = 2.4121 s$. $t_1$ represents the time it takes for event $A_1$ (killing in one hit) to occur. And time $t_2$ represents the time it takes for event $A_2$ (killing in two hits) to occur. Substituting in yields:

\begin{align*}
\mathbb{E}(\mathbf{TTK}) = \alpha \sum_{i=1}^{2} P(A_i) t_i = \alpha (0.55 (1.2061 s) + (0.45) 2.4121 s)
\end{align*}

Finally during Slayer's career skill, he has 40\% attack speed, plus 20\% with swift slaying, plus 5\% on charm, plus a passive 7.5\% for a total $\alpha$ modifier of $\alpha=72.5\%$. Note that increasing the speed of an animation by 72.5\% is equivalent to multiplying the animation duration by the following amount:
\begin{align*}
\alpha = \frac{1}{1+0.725}
\end{align*}
As such, our equation becomes:
\begin{align*}
\mathbb{E}(\mathbf{TTK}) = \tfrac{1}{1+0.725} (0.55 (1.2061 s) + (0.45) 2.4121 s)
\end{align*}
So our final result is:
\begin{align*}
\mathbb{E}(\mathbf{TTK}) = 1.046 s
\end{align*}

In real world terms, this means while spamming chain heavies, and attempting to hit the head of stormvermin. A player with 40\% HS\% expects to kill a stormvermin in 0.9439 seconds as long as their have their maximum attack speed up (which is a reasonable assumption in Onslaught modes of Vermintide). Some portion of the time they will kill them faster, and some portion of the time they will kill them slower. But as the number of stormvermin approaches a high number, they will die at a rate close to that. This is, assuming the player is able to constantly attack and never block. To account for real world variables, it is sufficient to model this discrepency between real world and theoretical results via an efficiency coefficient which I will call $\rho$. So our general expression looks more like:

\begin{align*}
\rho \mathbb{E}(\mathbf{TTK}) = \mathbf{TTK}_{measured} && \rho \in [0,1]
\end{align*}

If someone wanted to solve for $\rho$ it would require them to spawn waves of enemies in conditions they deem realistic and measure the discrepancies in TTK. That would be a realistic way of quantifying melee uptime but that is outside the scope of this discussion currently.

\section*{Extension: Arbitrary Breakpoints}

This math is cool and all, but something that would be useful to know is a robust way to derive TTK for an arbitrary number of hits. Now as much as I criticized DPS as a tool for understanding how weapons behave, in this section DPS will be absolutely critical for deriving our generalized expression for TTK. Lets start with an outline of the basic approach we are going to take:

\begin{enumerate}
\item[1.] Calculate the Average DPS of a particular weapon combo
\item[2.] Divide HP of a particular enemy by average DPS, round UP to nearest integer
\item[3.] Multiply that number by the time to do those attacks, factoring in attack speed buffs
\end{enumerate}

If we can do that, we now have the expected time to kill of virtually any weapon. Steps 2-3 are fairly straight forward but the first step will take some work.

\subsection{Average DPS}
Average DPS without factoring in crits or headshots is given by:

\begin{align*}
\text{DPS} = \frac{\text{base damage}}{\text{time of swing}}
\end{align*}
Headshot DPS is then given by
\begin{align*}
\text{hDPS} = \frac{\text{headshot damage}}{\text{time of swing}}
\end{align*}
Critical DPS
\begin{align*}
\text{cDPS} = \frac{\text{crit damage}}{\text{time of swing}}
\end{align*}
Critical Headshot DPS
\begin{align*}
\text{chDPS} = \frac{\text{crit headshot damage}}{\text{time of swing}}
\end{align*}

We can actually simplify these expressions somewhat. Most weapons damage templates have headshot and crit damage which can be expressed as in terms of base bodyshot damage and a multiplier called "finesse". Lets denote finesse by $f$, and base damage by $D$ our equations then become:
Headshot DPS is then given by
\begin{align*}
\text{bDPS} = \frac{D}{t}
\end{align*}
\begin{align*}
\text{hDPS} = \frac{f D+D}{t}
\end{align*}
Critical DPS
\begin{align*}
\text{cDPS} = \frac{f D+D}{t}
\end{align*}
Critical Headshot DPS
\begin{align*}
\text{hcDPS} = \frac{2f D+D}{t}
\end{align*}
Note that some weapon damage templates do not scale this way, but this scaling behavior is the norm for the majority of the weapons.

Before continuing, there are two last factors which significantly impact damage dealt which we need to account for before continuing. The first is a niche property of weapons known as the "Armor Modifier". Each weapon has a base damage, and a finesse modifier, but one other property is the armor modifier which acts as a coefficient which scales damage versus certain types of enemies. For example, one weapon which performs well against infantry might not pierce armor well. Or another weapon which can pierce armor might not pierce Super Armor very well. Or by contrast, one weapon might pierce armor well, but perhaps it doesn't perform much better versus Infantry than any other weapon. This info is encoded into the "armor modifier". There is also an "armor modifier" which works separately on critical hits which also must be factored in. Let $m_b$ denote the armor modifier versus the enemy breed in question for non critical hits, and $m_c$ denote the armor modifier for critical hits.

To account for this, we can modify our DPS terms like so:
\begin{align*}
\text{bDPS} = m_b \frac{D}{t}
\end{align*}
\begin{align*}
\text{hDPS} = m_b \frac{fD+D}{t}
\end{align*}
Critical DPS
\begin{align*}
\text{cDPS} = m_c \frac{fD+D}{t}
\end{align*}
Critical Headshot DPS
\begin{align*}
\text{hcDPS} = m_c \frac{ 2fD + D}{t}
\end{align*}

The one final term are level 15 row "stagger" talents. For the purposes of this calculator, we are only going to analyze Smiter and Assassin.

Smiter offers a flat 20\% increase in weapon damage across the board on the first target hit (the only target we are analyzing in this document) while Assassin offers a 40\% increase in damage to headshot damage. In other words, Smiter offers a modest boosts the damage of the lowest damage attacks and high damage attacks, while Assassin massively boosts the damage of the highest damage attacks. With these in mind, we should augment our equations for the Smiter and Assassin case. For Smiter we get:

Base DPS Smiter vs Assassin
\begin{align*}
\text{bDPS} = 1.2 (m_b \frac{D}{t}) && \text{bDPS} = m_b \frac{D}{t} 
\end{align*}
Headshot DPS Smiter vs Assassin
\begin{align*}
\text{hDPS} = 1.2(m_b \frac{fD + D}{t} ) && \text{hDPS} = 1.4(m_b \frac{fD + D}{t} )
\end{align*}
Critical DPS Smiter vs Assassin
\begin{align*}
\text{cDPS} = 1.2( m_c \frac{fD + D}{t} ) && \text{cDPS} = m_c \frac{ fD + D}{t}
\end{align*}
Critical Headshot DPS Smiter vs Assassin
\begin{align*}
\text{hcDPS} = 1.2( m_c \frac{ 2fD + D}{t} ) && \text{hcDPS} = 1.4( m_c \frac{ 2fD + D }{t} )
\end{align*}
However, just for simplifying the notation, lets just denote this modifier as $S$ for now. Just know later on when you see that term it expands in the manner I've described here.

So with these 4 DPS values in mind, to get the average expected DPS $\mathbb{E}(DPS)$, we need to determine the relative frequencies which these 4 events occur:
\begin{enumerate}
\item[1.] NOT Crit AND NOT Headshot
\item[2.] NOT Crit AND Headshot
\item[3.] Crit AND NOT Headshot
\item[4.] Crit AND Headshot
\end{enumerate}
By applying the AND rule we conclude:

\begin{enumerate}
\item[$w_1 = $] $(1-\rho) (1-\phi)$
\item[$w_2 = $] $(1-\rho) \phi$
\item[$w_3 = $] $\rho (1-\phi)$
\item[$w_4 = $] $\rho \phi$
\end{enumerate}

Thus, our expected DPS is a weighted average of these probability weights and our DPS values:

\begin{align*}
\mathbb{E}(DPS) = w_1 bDPS + w_2 hDPS + w_3 cDPS + w_4 hcDPS
\end{align*}
Expanding yields:
\begin{align*}
\mathbb{E}(DPS) = s (1-\rho) (1-\phi) \frac{m_b D}{t} + s\phi(1-\rho)\frac{m_b f D}{t} + s\rho(1-\phi) \frac{m_c f D}{t} + s (\rho \phi)\frac{m_c (f D)^2}{t}
\end{align*}


To make this more explicit, lets substitute in our stagger modifiers according to Smiter and Assassin:


\begin{align*}
\textbf{The Smiter Equation:}
\end{align*}
\begin{align*}
\boxed{ \mathbb{E}(DPS)_{Smiter} = 1.2 [(1-\rho) (1-\phi) m_b \frac{D}{t} + \phi(1-\rho) m_b \frac{ fD + D}{t} + \rho(1-\phi) m_c \frac{ fD + D}{t} + (\rho \phi) m_c \frac{2fD + D}{t} ] }
\end{align*}
\begin{align*}
\textbf{The Assassin Equation:}
\end{align*}
\begin{align*}
\boxed { \mathbb{E}(DPS)_{Assassin} = (1-\rho) (1-\phi) m_b \frac{D}{t} + \rho(1-\phi) m_c \frac{ fD + D}{t} + 1.4[ \phi(1-\rho) m_b \frac{ fD + D}{t} + (\rho \phi) m_c \frac{ 2fD + D}{t} ] }
\end{align*}

\pagebreak
\subsection{Breed HP and Expected Number of Hits}
Now that we have our average DPS complete, all we need to do is pick our breeds which we intend to run TTK testing on.

For the purposes of this document I am going to present some illustrative examples.

First lets talk about the nuances of pure infantry breakpoints, and to do this, we are going to focus on the fanatic, clan rat, marauder, and mauler.

\begin{enumerate}
\item[•] Fanatic 48hp
\item[•] Clan Rat 60hp
\item[•] Marauder 120hp
\item[•] Mauler 222hp
\end{enumerate}

The astute among you will have already noted that maulers count as infantry when hit in the body but super armor when hit to the head. We'll swing back to that later.

I chose infantry in particular because there are many enemies in that category, and hence it is tricky to design a weapon which performs well versus maulers but poorly versus fanatics or clan rats. ESPECIALLY if one doesn't take into account critical hit and headshot damage.

So in a normal non statistical approach, breakpoints are calculated via:
\begin{align*}
n = \lceil \tfrac{Breed HP}{DPS} \rceil
\end{align*}
If you are unfamilliar with the notation $\lceil • \rceil$ (because I sure was unfamilliar with it before typing this), these are the agreed upon symbols to denote that this value is always rounded up to the nearest integer. See \href{https://en.wikipedia.org/wiki/Floor_and_ceiling_functions}{here} if you're curious. But in our example, suppose $\tfrac{Breed HP}{DPS} = 4.75$, then we round that to $5$. If $\tfrac{Breed HP}{DPS} = 4.25$, then again we round that to $5$. This is of course because hits which do not deal lethal damage don't kill. There isn't a functional difference between alive and alive with 1hp, however there is a huge difference between 1hp and 0.

So as with before we intend to give this the statistical treatment factoring in randomness. However luckily, the heavy lifting has been done already for that. So expected time to kill is simply taking running the same operation on our expected DPS:

\begin{align*}
\mathbb{E}(n) = \lceil \frac{HP_{Breed}}{\mathbb{E}(DPS)} \rceil
\end{align*}

So as a quick example, suppose we have a weapon such as the Cog Hammer as we discussed in the first part. Well according to VernonKun's spreadsheet Kruber's 1 handed sword deals 64.354 DPS with Assassin, and a 50\% headshot rate as well as no power or attack speed buffs. So under these parameters:

\begin{align*}
\mathbb{E}(n)_{fanatic} = \lceil \frac{48HP}{64.354\tfrac{HP}{s}} \rceil = 1
\end{align*}
\begin{align*}
\mathbb{E}(n)_{Clan Rat} = \lceil \frac{60HP}{64.354\tfrac{HP}{s}} \rceil = 1
\end{align*}
\begin{align*}
\mathbb{E}(n)_{Marauder} = \lceil \frac{120HP}{64.354\tfrac{HP}{s}} \rceil = 2
\end{align*}
\begin{align*}
\mathbb{E}(n)_{Mauler} = \lceil \frac{222HP}{64.354\tfrac{HP}{s}} \rceil = \textbf{4}
\end{align*}
If you play Vermintide a lot, this result for the Mauler should stick out like a sore thumb to you. This expression predicts a mauler is expected to die in 4 hits, meaning it can sometime die in less hits than that and sometimes more. I can tell you for free that this is very much NOT correct. But remember that in this example, I outlined a 50\% headshot ratio. Well as many of you reading this probably are aware, mauler heads are super armored and as such our DPS equation is overestimating DPS versus maulers by a wide margin. To eliminate this bias, we must pretend that the headshot ratio is zero. Doing this yields a new DPS of $36.899$
\begin{align*}
\mathbb{E}(n)_{Marauder} = \lceil \frac{222HP}{36.899\tfrac{HP}{s}} \rceil = 7
\end{align*}
7 hits to kill a mauler is a much more realistic figure, however even this figure is imperfect as the possibility of accidentally hitting the head always exists. I wanted to highlight this example to demonstrate the limitations of this approach, and warn you that you must be careful not to violate the assumptions of this calculation.

\pagebreak

\subsection{Expected Time to Kill}

The final step is to take the expected number of hits and multiply it by the time it takes for a weapon to swing.

For certain weapons and certain combos, this is straightforward. For example, on the 1 handed axe for Bardin and Saltzpyre, most players tend to use chain light attacks (light 1, light 2, light 3) over and over. These attacks have a predictable duration with each attack. However, upon closer inspection not all of these attacks have the same duration. The attack duration with no attack speed buffs are listed as follows:

\begin{enumerate}
\item[Light 1] 0.5314s
\item[Light 2] 0.4831s
\item[Light 3] 0.5769s
\end{enumerate}

This difference in attack speed is minor for this particular weapon, but for other weapons or other attacks, this difference can be start. For example, Billhook's Heavy 2 + Light 1 combo has a much more significant difference between the timing of H2 and L1, and hence starting with heavy, or light can make a noticeable difference in TTK starting from one or the other. So in order to account for this, we will take the average of these $k$, where $k$ denotes the number of attacks in the combo:

\begin{align*}
t_{base} = \frac{1}{k} \sum_{i=1}^{k} t_i
\end{align*}

One thing to note is that this value is unscaled by any attack speed modifiers. Attack speed stacks are additive, and they have an inverse relation with animation time. As such, an attack speed modifier is given by
\begin{align*}
a_s = \frac{1}{1+100\times\sum_{i=1}^{j} u_i}
\end{align*}
Where the term $\sum_{i=1}^{j} u_i$ simply denotes every cumulative source of attack speed(in percent form).

So scaled by attack speed, $t$ then is given by:
\begin{align*}
t = a_s t_{base}
\end{align*}

So to tie everything into a neat bow, our most generalized equation is:

\begin{equation}
\boxed{ \mathbb{E}(TTK) = a_s t_{base} \lceil \frac{{HP}_{breed}}{\mathbb{E}(DPS)} \rceil }
\end{equation}

And the uglier but more useful forms written in terms of Assassin and Smiter are given by:

\begin{align*}
 \mathbb{E}(TTK)_{Smiter} = a_s t_{base} \lceil \frac{a_s t_{base}  {HP}_{breed} }{1.2 [(1-\rho) (1-\phi) m_b D + \phi(1-\rho) m_b (fD + D) + \rho(1-\phi) m_c (fD + D) + (\rho \phi) m_c (2fD + D) ]} \rceil
\end{align*}


\begin{align*}
\mathbb{E}(TTK)_{Assasin} = a_s t_{base} \lceil \frac{a_s t_{base}  {HP}_{breed} }{(1-\rho) (1-\phi) m_b D + \rho(1-\phi) m_c (fD + D) + 1.4[ \phi(1-\rho) m_b (fD + D) + (\rho \phi) m_c ( 2fD + D) ]} \rceil
\end{align*}
\pagebreak

\begin{comment}
\subsubsection{A Quick Side Note}
Before continuing I want to highlight something really cool about this equation. 

\begin{align*}
 \mathbb{E}(TTK)_{smiter} =  a_s t_{base} \lceil \frac{ 1.2\times D[(1-\rho) (1-\phi) m_b + \phi(1-\rho)m_b f + \rho(1-\phi) m_c f + (\rho \phi) m_c f^2 ] }{a_s t_{base} HP_{Breed}} \rceil
\end{align*}

If you are like me, you saw this factor of $a_s t_{base}$ in the denominator of the fraction and thought to yourself ``Oh wow! Look it cancels out!". But this is NOT so, as the rounding function prevents us from legally being able to do that. But what if we pretended for a moment that we could do that? Well if we could cancel out it out we would be left with:


\begin{align*}
 \mathbb{E}(TTK)_{smiter} =  \lceil \frac{ 1.2\times D[(1-\rho) (1-\phi) m_b + \phi(1-\rho)m_b f + \rho(1-\phi) m_c f + (\rho \phi) m_c f^2 ] }{ HP_{Breed}} \rceil
\end{align*}

Which is essentially

\begin{align*}
TTK = \frac{ \text{Damage Done In Set Amount of Time}}{\text{Health of Enemy}}
\end{align*}

In other words, this is the erroneous intuitive conclusion which I opened this article with: that DPS = Kill Rate. I find this fascinating, because it gives intuition into what the function of the rounding function $f(x) = \lceil x \rceil$ is doing: the rounding function is correcting for the error which is made by assuming DPS is equivalent to the kill rate.
\end{comment}

\pagebreak

\subsection{Examples!}

With our equations in hand, lets run some TTK tests on some example numbers.

\end{document}
